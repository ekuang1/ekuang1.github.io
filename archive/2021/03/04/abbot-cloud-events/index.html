<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="twitter:card" content="summary">
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Subscribing to cloud events with Abbot" />
  <meta name="twitter:description" content="Subscribe to notifications about important events in your cloud infrastructure using Abbot in a few easy steps!" />
  <meta name="twitter:url" content="" />
  <meta name="twitter:image" content="https://user-images.githubusercontent.com/19977/110027163-7f009900-7ce6-11eb-8aba-5b1d96ef0b6d.png" /><meta name="twitter:site" content="@haacked" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Subscribing to cloud events with Abbot | You’ve Been Haacked</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Subscribing to cloud events with Abbot" />
<meta name="author" content="Phil Haack" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Subscribe to notifications about important events in your cloud infrastructure using Abbot in a few easy steps!" />
<meta property="og:description" content="Subscribe to notifications about important events in your cloud infrastructure using Abbot in a few easy steps!" />
<meta property="og:site_name" content="You’ve Been Haacked" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-04T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Subscribing to cloud events with Abbot" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Phil Haack"},"@type":"BlogPosting","description":"Subscribe to notifications about important events in your cloud infrastructure using Abbot in a few easy steps!","url":"/archive/2021/03/04/abbot-cloud-events/","headline":"Subscribing to cloud events with Abbot","dateModified":"2021-03-04T00:00:00-06:00","datePublished":"2021-03-04T00:00:00-06:00","mainEntityOfPage":{"@type":"WebPage","@id":"/archive/2021/03/04/abbot-cloud-events/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/assets/css/main.css">
  <link type="application/atom+xml" rel="alternate" href="/atom.xml" title="You've Been Haacked" />
  
  <script src="/assets/js/utils.js"></script>
  <script src="/assets/js/slash.js" async></script>
  
	<script src="/assets/js/md5.min.js" async></script>
  <script src="/assets/js/comment-box.js" async></script>
  
  <link href="https://fonts.googleapis.com/css?family=Mate|Open+Sans|Open+Sans+Condensed:300" rel="stylesheet">
</head>

  <body>
    <header class="header" class="inner"><div class="site-header">
  <div class="profilepic">
    
    <img src="https://2.gravatar.com/avatar/cdf546b601bf29a7eb4ca777544d11cd?s=160" alt="Profile Picture" />
    
  </div>

  
  <a class="site-title" rel="author" href="/">You&#39;ve Been Haacked</a>
  
  <div class="site-subtitle">…and you like it</div>
  
  
  
    <nav class="site-nav">
      <ul>
          
          
          
          
          <li><a class="page-link" href="/about/">About</a></li>
          
        
          
          
          
          <li><a class="page-link" href="/archives/">Archives</a></li>
          
        
          
          
          
          <li><a class="page-link" href="/contributors/">Contributors</a></li>
          
        
        
        <li><a class="page-link" href="https://github.com/Haacked/feedback/issues/new">Contact</a></li>
        
      </ul>
    </nav>
  
  <div class="social-footer">
    <ul class="social-media-list">
  
  
  
  <li><a href="https://github.com/haacked"><svg class="svg-icon"><use xlink:href="/assets/svg/minima-social-icons.svg#github"></use></svg> <span class="username">haacked</span></a></li>
  
  
  
  <li><a href="https://twitter.com/haacked"><svg class="svg-icon"><use xlink:href="/assets/svg/minima-social-icons.svg#twitter"></use></svg> <span class="username">haacked</span></a></li>
  
  
  <li><a href="http://feeds.haacked.com/haacked"><svg class="svg-icon"><use xlink:href="/assets/svg/minima-social-icons.svg#rss"></use></svg> <span>rss</span></a></li>
</ul>


<!--  viewBox="0 1 16 14" -->
  </div>
</div>
</header>
    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Subscribing to cloud events with Abbot</h1>
    <div class="meta">
  <time class="date dt-published" datetime="2021-03-04T00:00:00-06:00" itemprop="datePublished">
    
    Mar 4, 2021
  </time>
  <span class="tags">

  <a href="/tags/#abbot">abbot</a> 

  <a href="/tags/#chatops">chatops</a> 

  <a href="/tags/#csharp">csharp</a> 

</span>
  
    
  


  
  <span class="edit">



<a href="https://github.com/haacked/haacked.com/edit/gh-pages/_posts/2021/2021-03-04-abbot-cloud-events.markdown">suggest edit</a>
</span>
</div>

  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>In <a href="https://haacked.com/archive/2021/02/19/writing-abbot-skill-in-csharp/">my last post</a>, I wrote about writing a sparkly skill in Abbot. That was fun! But Abbot isn’t <em>only</em> about fun. After all, our company name is <a href="https://aseriousbusiness.com/">A Serious Business, Inc.</a> Seriously, that’s the name. So it’s about time I show you how to get to some serious business with Abbot.</p>

<p>Here’s the scenario: We have a <a href="https://martinfowler.com/bliki/BlueGreenDeployment.html">Blue Green deployment</a> set up for the <a href="https://martinfowler.com/bliki/BlueGreenDeployment.html">Abbot website</a>. In Azure parlance, we use <a href="https://docs.microsoft.com/en-us/azure/app-service/deploy-staging-slots">Deployment Slots</a> to set this up. This allows us to deploy to stage, and have an automatic cutover to production if everything is fine. But this process can seem opaque in action. It’d be nice to receive a notification when a deployment to stage is complete and the swap is starting. That’s where the new Abbot <a href="https://ab.bot/packages/aseriousbiz/cloud-event"><code class="language-plaintext highlighter-rouge">cloud-event</code></a> skill comes in handy.</p>

<p>I <a href="https://www.youtube.com/watch?v=nMKZFzVGutY">recorded a video</a> so you can watch to see it in action. But I’ll write about it here too.</p>

<p><a href="https://www.youtube.com/watch?v=nMKZFzVGutY"><img src="https://user-images.githubusercontent.com/19977/110027163-7f009900-7ce6-11eb-8aba-5b1d96ef0b6d.png" alt="YouTube video of the cloud-event skill in action" /></a></p>

<p>The <code class="language-plaintext highlighter-rouge">cloud-event</code> skill supports the <a href="https://github.com/cloudevents/spec/blob/v1.0.1/http-webhook.md">Cloud Events Web Hooks for Event Delivery</a> specification. That means it can support any cloud provider that implements the spec, which I assume is most of them.</p>

<p>In our case, we use <a href="https://docs.microsoft.com/en-us/azure/event-grid/overview">Azure Event Grid</a> to subscribe to events happening in our cloud infrastructure. Here’s how it works.</p>

<h2 id="create-azure-event-grid-subscription">Create Azure Event Grid Subscription</h2>

<p>In the <a href="https://portal.azure.com/">Azure Portal</a> search up “Event Grid Subscriptions” and click on that to get to the event grid subscriptions page. Note, this page is pre-filtered which can be confusing (I let the team know and they promise to make this UI better).</p>

<p><img src="https://user-images.githubusercontent.com/19977/110028278-e539eb80-7ce7-11eb-9e71-17c45702bfda.png" alt="Event Grid Subscriptions" /></p>

<p>From here click the plus sign next to “Event Subscription” to create a new subscription.</p>

<ol>
  <li>For the “Event Schema” choose “Cloud Event Schema 1.0”.</li>
  <li>For the “Topic Types” choose “App Services.”</li>
  <li>For “Endpoint Type” choose “Web Hook”</li>
</ol>

<p>At this point, it should look something like this. Now we just need a web hook URL. This is where Abbot comes in!</p>

<p><img src="https://user-images.githubusercontent.com/19977/110028281-e5d28200-7ce7-11eb-8037-e1d64d6a0483.png" alt="Screen Shot 2021-03-04 at 12 46 59 PM" /></p>

<p>At this point, I assume you have an Abbot account set up and connected to a chat room. If not, go to <a href="https://ab.bot/">https://ab.bot/</a> and click “Log In” and use your Slack or Discord login to log in. Follow the instructions to get it set up.</p>

<p>Next, we need to install the <code class="language-plaintext highlighter-rouge">cloud-event</code> package. On the <a href="https://ab.bot/packages/aseriousbiz/cloud-event"><code class="language-plaintext highlighter-rouge">cloud-event</code></a> package page, click the “Install Package” button. It’ll give you a chance to review the code before it actually installs it. Click “Create skill from package” and now you have the skill enabled!</p>

<p>Go to a chat room with Abbot. In our case, we have an <code class="language-plaintext highlighter-rouge">#ops</code> room for this sort of notification. Then run the following in chat:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@abbot attach cloud-event
</code></pre></div></div>

<p>What that does is create an HTTP trigger for the skill attached to the room where you ran it. An HTTP trigger is a secret URL that can be used to call the skill. And the skill will respond to the room it’s attached to.</p>

<p>When you run the command, Abbot will respond with something like:</p>

<blockquote>
  <p>The skill <code class="language-plaintext highlighter-rouge">cloud-event</code> is now attached to the channel <code class="language-plaintext highlighter-rouge">ops</code>. Visit https://ab.bot/skills/cloud-event/triggers to get the secret URL used to call this skill.</p>
</blockquote>

<p>Grab that URL, and go back to the Event Grid Subscription page, and click “Select an endpoint” and supply the trigger URL as the web hook endpoint. Click “Create” and you’re done! You can trigger a deploy to see it in action. Or just change an App Setting to get an <code class="language-plaintext highlighter-rouge">AppUpdated</code> notification. If you run into any problems, you can see a log of the last 100 HTTP requests that the skill received.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@abbot cloud-event log
</code></pre></div></div>

<p>And you can inspect more details such as the HTTP headers and the request body by specifying which log entry to look at:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@abbot cloud-event log 42
</code></pre></div></div>

<p>This is a powerful example of the value of Abbot in a chat ops workflow. If you’re interested in learning more about Abbot, check out <a href="https://haacked.com/archive/2021/02/11/introducing-abbot/">my introduction to Abbot</a>, <a href="https://dotnetrocks.com/?show=1726">my .NET Rocks episode on Abbot</a>, or just peruse the <a href="https://ab.bot/">Abbot website</a>. And when you watch the video, don’t forget to smash that like button!</p>

  </div>
  <span class="edit">Found a typo or mistake in the post? 



<a href="https://github.com/haacked/haacked.com/edit/gh-pages/_posts/2021/2021-03-04-abbot-cloud-events.markdown">suggest edit</a>
</span>

  
    
  






<div id="comments" class="comments">
  <h2>Comments</h2>
  <form action="/fake" data-action="https://haacked-blog.azurewebsites.net/api/PostComment" method="post" class="comment-form form-horizontal comment-box">
    <input name="redirect" type="hidden" value="/thanks">
    <input name="post_id" type="hidden" value="abbot-cloud-events">
    <input name="comment-site" type="hidden" value="">
    <div class="comment-box">
        <img src="/assets/img/unknown-avatar.png" data-fallbacksrc="/assets/img/unknown-avatar.png" data-role="user-avatar" alt="avatar" class="avatar" id="avatar-preview" />
        <div class="commenttext">
        <div class="comment-status status"></div>
        <div contenteditable="true" tabindex="0" role="textbox" aria-multiline="true" data-role="editable" class="textarea plaintext" aria-label="Join the discussion..." id="comment-div" data-target="message"></div>
        <input type="hidden" name="message" id="message" data-required="true" value="" />
        </div>
    </div>
    <div class="comment-author">
        <div class="control-group">
        <input type="hidden" name="avatar" id="avatar-input" />
        <input type="text" name="name" id="name" placeholder="Display Name" title="Name displayed with your comment" data-required="true" />
        <input type="text" name="identity" id="identity" placeholder="email/@twitter/github" data-required="true" value="" />
        <span class="info-circle" title="Identity is used to generate an avatar image only. It is cleared out when you click submit and not sent to the server."></span>
        <button type="button" class="comment-button">Leave response</button>
        <div class="remember-me">
            <input type="checkbox" name="remember" id="remember"><label for="remember">Remember me</label>
            <span class="info-circle" title="Stores your name and email in the browser so you don't have to fill out the form again. This does not set a cookie."></span>
        </div>
        </div>
    </div>
</form>

  <h3 class="comment-count">One response</h3>
  <ol class="comments-list">
  
  
    
    <li>
      <!-- URL for comment on GitHub
https://github.com/haacked/haacked.com/blob/gh-pages/_data/comments/abbot-cloud-events/6a0519dc.yml
-->


<img alt="Avatar for Matthews Natasha" src="https://secure.gravatar.com/avatar/f7ac09386664646a3bb9fcdab44b7223?s=80&d=identicon&r=pg" class="avatar" height="48" width="48">


<blockquote id="6a0519dc">
  <cite>
    <span class="author">
      
        Matthews Natasha
      
    </span>
    <span class="bullet">•</span>
    <a href="#6a0519dc" class="muted" title="Fri, 05 Mar 2021 05:38:29 -0600">
      March
      
      5th,
      
      2021
    </a>
  </cite>
  <div class="comment-body"><p>Abbot is simply the best. Thanks for sharing your review</p>
</div>
</blockquote>

    </li>
  
  </ol>
</div>


  

  <a class="u-url" href="/archive/2021/03/04/abbot-cloud-events/" hidden></a>
</article>

      </div>
      <footer class="site-footer h-card">
  <div class="wrapper">
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">
            
              Phil Haack
            
            </li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
  
  
  
  <li><a href="https://github.com/haacked"><svg class="svg-icon"><use xlink:href="/assets/svg/minima-social-icons.svg#github"></use></svg> <span class="username">haacked</span></a></li>
  
  
  
  <li><a href="https://twitter.com/haacked"><svg class="svg-icon"><use xlink:href="/assets/svg/minima-social-icons.svg#twitter"></use></svg> <span class="username">haacked</span></a></li>
  
  
  <li><a href="http://feeds.haacked.com/haacked"><svg class="svg-icon"><use xlink:href="/assets/svg/minima-social-icons.svg#rss"></use></svg> <span>rss</span></a></li>
</ul>


<!--  viewBox="0 1 16 14" -->
      </div>

      <div class="footer-col footer-col-3">
        <p>You&#39;ve been Haacked is a blog about Technology, Software, Management, and Open Source. It&#39;s full of good stuff.
</p>
      </div>
    </div>

  </div>

</footer>

    </main>
  </body>
</html>
