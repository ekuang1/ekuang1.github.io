id: dsq-747524545
date: 2010-04-20T09:00:04.0000000-07:00
name: Terry Aney
avatar: https://disqus.com/api/users/avatars/Terry Aney.jpg
message: "<p>Made a slight change to check a config setting so that you don't have to rebuild to turn on and off the debugging...not sure if helpful, but here are my changes...(just my additions/changes listed)<br><code><br>protected void Application_BeginRequest( object sender, EventArgs e )<br>{<br>if ( bool.Parse( ConfigurationManager.AppSettings[ \"RouteDebug\" ] ?? \"false\" ) )<br>{<br>RouteDebugger.RewriteRoutesForTesting( RouteTable.Routes );<br>}<br>else<br>{<br>RouteDebugger.RemoveTestingRoutes( RouteTable.Routes );<br>}<br>}<br></code><br>Needed a way to restore RouteHandlers...<br><code><br>public class DebugRoute : Route<br>{<br>...<br>public Dictionary&lt;RouteBase, IRouteHandler&gt; RouteHandlers { get; private set; }<br>}<br></code><br>Then changes to RouteDebugger...<br><code><br>public static class RouteDebugger<br>{<br>public static void RemoveTestingRoutes( RouteCollection routes )<br>{<br>using ( routes.GetReadLock() )<br>{<br>var debugRoute = routes.FirstOrDefault( r =&gt; r == DebugRoute.Singleton );<br>if ( debugRoute != null )<br>{<br>routes.Remove( debugRoute );<br>foreach ( RouteBase routeBase in routes )<br>{<br>Route route = routeBase as Route;<br>if ( route != null )<br>{<br>route.RouteHandler = DebugRoute.Singleton.RouteHandlers[ routeBase ];<br>}<br>}<br>DebugRoute.Singleton.RouteHandlers.Clear();<br>}<br>}<br>}<br>public static void RewriteRoutesForTesting( RouteCollection routes )<br>{<br>using ( routes.GetReadLock() )<br>{<br>var debugRoute = routes.FirstOrDefault( r =&gt; r == DebugRoute.Singleton );<br>if ( debugRoute == null )<br>{<br>routes.Add( DebugRoute.Singleton );<br>foreach ( RouteBase routeBase in routes.Where( r =&gt; r != DebugRoute.Singleton ) )<br>{<br>Route route = routeBase as Route;<br>if ( route != null )<br>{<br>DebugRoute.Singleton.RouteHandlers.Add( routeBase, route.RouteHandler );<br>route.RouteHandler = new DebugRouteHandler();<br>}<br>}<br>}<br>}<br>}<br>}<br></code></p>"
