id: dsq-747514817
date: 2012-09-05T16:12:11.0000000-07:00
name: Graham
avatar: https://disqus.com/api/users/avatars/Graham.jpg
message: "<p>Here's a fix that might help some folks.<br>I was getting a STOR 550 error when running the stored proc. It was when it was attempting to put the file on the FTP server. <br>I figured out that the /@ftpPath/@FTPFileName was not doing the cd (change directory) properly. So I added a few lines and modified one.<br>/*** all code above this part is perfect ***/<br>select@cmd = 'echo '+ 'open ' + @FTPServer<br>+ ' &gt; ' + @workdir + @workfilename<br>exec master..xp_cmdshell @cmd<br>select@cmd = 'echo '+ @FTPUser<br>+ '&gt;&gt; ' + @workdir + @workfilename<br>exec master..xp_cmdshell @cmd<br>select@cmd = 'echo '+ @FTPPWD<br>+ '&gt;&gt; ' + @workdir + @workfilename<br>exec master..xp_cmdshell @cmd<br>/*** Added lines: ***/<br>select@cmd = 'echo cd '+ @FTPPath<br>+ '&gt;&gt; ' + @workdir + @workfilename<br>exec master..xp_cmdshell @cmd<br>/*** End of added lines ***/<br>/*** Modified line.. deleted the \"+ @FTPPath\" from this append ***\\<br>select@cmd = 'echo '+ 'put ' + @SourcePath + @SourceFile + ' '  + @FTPFileName<br>+ ' &gt;&gt; ' + @workdir + @workfilename<br>exec master..xp_cmdshell @cmd<br>select@cmd = 'echo '+ 'quit'<br>+ ' &gt;&gt; ' + @workdir + @workfilename<br>exec master..xp_cmdshell @cmd<br><br>select @cmd = 'ftp -s:' + @workdir + @workfilename<br>-- All code below this works perfect<br>/*<br>Just a heads up the directory on the server is just the name of the directory. eg. public  not /public/ . So the cd command is cd public.<br>All the rest of the code worked like a hot damn. Thanks Nigel you write some fine code. I'm not worthy.<br>*/<br></p>"
