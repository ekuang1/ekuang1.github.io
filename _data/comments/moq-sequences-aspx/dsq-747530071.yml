id: dsq-747530071
date: 2009-12-22T23:49:50.0000000-08:00
name: Marcos
avatar: https://disqus.com/api/users/avatars/Marcos.jpg
message: '<p>Lol I just sent this code to the Moq discussion group:<br>using Moq.Language.Flow;<br>using Moq.Utils;<br><br>namespace Moq<br>{<br>    public static class MoqExtensionMethods<br>    {<br>        public static IReturnsResult&lt;TMock&gt; ReturnsInOrder&lt;TMock, TResult&gt;(this ISetup&lt;TMock, TResult&gt; setup, params TResult[] values) where TMock : class<br>        {<br>            var multipleReturn = new CircularValueProvider&lt;TResult&gt;(values);<br>            return setup.Returns(multipleReturn.Next);<br>        }<br>    }<br>}<br>namespace Moq.Utils<br>{<br>    public sealed class CircularValueProvider&lt;T&gt;<br>    {<br>        private readonly T[] mValuesToReturn;<br>        private int mIndex = 0;<br>        public CircularValueProvider(params T[] valuesToReturn)<br>        {<br>            mValuesToReturn = valuesToReturn;<br>        }<br>        public T Next()<br>        {<br>            if (mValuesToReturn.Length == 0)<br>                return default(T);<br>            var res = mValuesToReturn[mIndex];<br>            mIndex = (mIndex + 1) % mValuesToReturn.Length;<br>            return res;<br>        }<br>    }<br>}<br>Not is important to return the IReturnsResult&lt;TMock&gt; ?<br>The only diff is that this uses a circular list to return values<br>Cheers</p>'
