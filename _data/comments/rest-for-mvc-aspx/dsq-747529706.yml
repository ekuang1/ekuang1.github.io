id: dsq-747529706
date: 2009-08-30T10:06:00.0000000-07:00
name: Liu Peng
avatar: https://disqus.com/api/users/avatars/Liu Peng.jpg
message: "<p>@Ranamauro: I try to return the JSON type of result by pass a accept type \"application/json\", what I use is jQuery's AJAX.<br>But the response is also the HTML format like the above:<br>$.getJSON('<a href=\"http://localhost:8082/\" rel=\"nofollow noopener\" title=\"http://localhost:8082/\">http://localhost:8082/</a>')<br>When I add a query string parameter \"?format=Json\" the result will be JSON type:<br>$.getJSON('<a href=\"http://localhost:8082/?format=Json\" rel=\"nofollow noopener\" title=\"http://localhost:8082/?format=Json\">http://localhost:8082/?format=Json</a>')<br>I debugged the source code and find that the $.getJSON will pass three accept types and the order is<br>    [0]: {application/json}<br>    [1]: {text/javascript}<br>    [2]: {*/*}<br>In the HttpHelper.GetAcceptHeaderElements function has one code will store the content type:<br>contentTypeList.Sort(new AcceptHeaderElementComparer());<br>After store the order will be:<br>    [0]: {*/*}<br>    [1]: {text/javascript}<br>    [2]: {application/json}<br>In the WebApiEnabledAttribute.OnActionExecuted only the first content type \"/\" will be pass, so the result is HTML and NOT JSON.<br>After I commented the sort code the result will be JSON.<br>Could you tell me the purpose for the \"sort\" code?</p>"
