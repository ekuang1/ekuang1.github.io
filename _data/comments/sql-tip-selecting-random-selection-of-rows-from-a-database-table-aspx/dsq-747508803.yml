id: dsq-747508803
date: 2010-05-20T20:19:01.0000000-07:00
name: David Morton
avatar: https://disqus.com/api/users/avatars/David Morton.jpg
message: "<p>I have been researching both the Rand() and NewId() methods and as stated above, NewId() is great for small sets of data but not so great with large datatables.  However, knowing about your data should help!  In my case, I counted the rows of data that would be return using my filters (where clauses) and then used that as a multiplier against Rand().  I knew what my desired sampling would be so here is what I did.<br>-- **************************************************<br>declare @threshold decimal(8,2)<br>set @threshold = 9.99<br>Declare @somedate char(8)<br>set @somedate = '20100518'<br>declare @rows int<br>Select @rows=COUNT(*) from sometable<br>where SOME_DATE = @somedate <br>and P_C_CODE = '3'<br>and C_A_DUE &gt; @threshold<br>and R_T_CODE = '1'<br>and  S_M_CODE != 'S'<br><br>Declare @rowno int<br>declare @i int<br>set @i = 1<br>-- This loop guarantees that we get unique rows in our sample.<br>while @i &lt;= 60  -- the number of samples I want.<br>BEGIN<br>set @rowno = cast(RAND() * @rows as int)<br>if not exists(Select * from @t where RecNo = @rowno)<br>BEGIN<br>Insert into @t Values (@rowno)<br>set @i = @i + 1<br>END<br>END<br>Select <br>ROW_NUMBER() over (Order by R_T_Code) as RowNum<br>,MyField1 as fld1<br>,       MyField2 as fld2<br>into #ctedata<br>from SomeTable<br>where SOME_DATE = @somedate <br>and P_C_CODE = '3'<br>and C_A_DUE &gt; @threshold<br>and R_T_CODE = '1'<br>and  S_M_CODE != 'S'<br>Select <br> *<br>from #ctedata a<br>inner join<br>@t b<br>on a.RowNum = b.RecNo<br>order by a.mbr_No</p>"
