id: dsq-747536269
date: 2011-10-22T14:48:43.0000000-07:00
name: Softlion
avatar: https://disqus.com/api/users/avatars/Softlion.jpg
message: '<p>I wrote an AjaxAwareAuthorizeAttribute, inherited from AuthorizeAttribute, which returns an http 409 response (Switch Proxy) instead of a 401.<br>It sets the X-Redirect header to the intended redirect url and jQuery handles this globally as demonstrated in this blog post.<br>Ok you need to know which action is called by ajax, and set this filter specifically on those. My first approach was less intrusive as you leave the [Authorize] attribute but does not work as explained below.<br>My first idea : intercept action responses by setting once a global MVC action filter, which detects the result type and replace it with an AjaxRedirectResonse which returns 409 as above.<br>But MVC has a special handling of authorize filters : after MVC calls an authorize filter, if this filter changes the action result then MVC will bypasse all other filters, whichever type they have.<br>And [Authorize] is an authorize filter ... So this approach does not work and i sticked with the above version.<br><br>Bonus 1:<br>I wrote an AjaxAwareRedirectResult result type, which will <br>X-Redirect but also X-Redirect-Top. This handles the case where you want to redirect outside an iframe.<br>Bonus 2:<br>In AjaxAwareAuthorizeAttribute I modified the way FormsAuthentication gets the redirect url because the web.config version is not aware of areas and i needed one different auth page per area. But this is another story.<br></p>'
