id: dsq-747536380
date: 2011-10-22T19:36:49.0000000-07:00
name: Softlion
avatar: https://disqus.com/api/users/avatars/Softlion.jpg
message: '<p>Yo,<br>thanks for your blog post, it is a question i retained since so a long time !<br>Here is an optimized version of your code.<br><code><br>    public class WebTaskHost : IRegisteredObject<br>    {<br>        private readonly object _lock = new object();<br>        private bool isShuttingDown;<br>        public WebTaskHost()<br>        {<br>            HostingEnvironment.RegisterObject(this);<br>        }<br>        public void Stop(bool immediate)<br>        {<br>            if (isShuttingDown)<br>                return;<br>            lock (_lock)<br>            {<br>                if (isShuttingDown)<br>                    return;<br>                isShuttingDown = true;<br>                HostingEnvironment.UnregisterObject(this);<br>            }<br>        }<br>        public void DoWork(Action action)<br>        {<br>            if (isShuttingDown)<br>                return;<br>            lock (_lock)<br>            {<br>                if (isShuttingDown)<br>                    return;<br>                action();<br>            }<br>        }<br>    }<br></code><br></p>'
