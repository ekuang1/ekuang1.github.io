id: dsq-747530765
date: 2012-03-14T15:55:19.0000000-07:00
name: Tom
avatar: https://disqus.com/api/users/avatars/Tom.jpg
message: "<p>I'm using MVC 2, and I've written the following custom validation attribute:<br><code><br>[AttributeUsage(AttributeTargets.Property)]<br>public sealed class CompareAttribute : ValidationAttribute<br>{<br>private const string _DO_NOT_MATCH_ERROR_MESSAGE = \"'{0}' and '{1}' do not match.\";<br>private const string _UNKNOWN_PROPERTY_ERROR_MESSAGE = \"Could not find property '{0}'.\";<br>public CompareAttribute(string otherProperty)<br>: base(_DO_NOT_MATCH_ERROR_MESSAGE)<br>{<br>if (otherProperty == null)<br>throw new ArgumentNullException(\"otherProperty\");<br>this.OtherProperty = otherProperty;<br>}<br>public string OtherProperty { get; private set; }<br>public override string FormatErrorMessage(string name)<br>{<br>return string.Format(CultureInfo.CurrentUICulture, base.ErrorMessageString, new object[]<br>{<br>name,<br>OtherProperty<br>});<br>}<br>protected override ValidationResult IsValid(object value, ValidationContext validationContext)<br>{<br>PropertyInfo property = validationContext.ObjectType.GetProperty(this.OtherProperty);<br>ValidationResult result = null;<br>if (property == null)<br>{<br>string validationErrorMessage = string.Format(CultureInfo.CurrentCulture, _UNKNOWN_PROPERTY_ERROR_MESSAGE, new object[]<br>{<br>this.OtherProperty<br>});<br>result = new ValidationResult(validationErrorMessage);<br>}<br>else<br>{<br>object propertyValue = property.GetValue(validationContext.ObjectInstance, null);<br>if (!object.Equals(value, propertyValue))<br>{<br>string validationErrorMessage = this.FormatErrorMessage(validationContext.DisplayName);<br>result = new ValidationResult(validationErrorMessage);<br>}<br>}<br>return result;<br>}<br>}<br></code><br>Problem is, the validationContext, when IsValid() is called, is always null.  Why?<br>Unfortunately, I cannot upgrade to MVC 3--I work in a large organization where every tech we use has to be \"approved\".</p>"
