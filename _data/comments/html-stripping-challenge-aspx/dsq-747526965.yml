id: dsq-747526965
date: 2008-11-11T02:35:29.0000000-08:00
name: Craig
avatar: https://disqus.com/api/users/avatars/Craig.jpg
message: "<p>Here's how I used to do it in Delphi. Someone can convert to C# if they can be bothered. This solution is probably not that scalable as it creates an instance if the WebBrowser every time but it is pretty reliable.<br><code><br>function HtmlToText(const _html: string): string;<br>var WebBrowser: TWebBrowser;<br>   Document: IHtmlDocument2;<br>   Doc: OleVariant;<br>   v: Variant;<br>   Body: IHTMLBodyElement;<br>   TextRange: IHTMLTxtRange;<br>begin<br>   Result := '';<br>   WebBrowser := TWebBrowser.Create(nil);<br>   try<br>     Doc := 'about:blank';<br>     WebBrowser.Navigate2(Doc);<br>     Document := WebBrowser.Document as IHtmlDocument2;<br>     if (Assigned(Document)) then<br>     begin<br>       v := VarArrayCreate([0, 0], varVariant);<br>       v[0] := _html;<br>       Document.Write(PSafeArray(TVarData(v).VArray));<br>       Document.Close;<br>       Body := Document.body as IHTMLBodyElement;<br>       TextRange := Body.createTextRange;<br>       Result := TextRange.text;<br>     end;<br>   finally<br>     WebBrowser.Free;<br>   end;<br>end;<br></code></p>"
