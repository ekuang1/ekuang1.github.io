id: dsq-1782541685
replyToId: dsq-1462763275
date: 2015-01-09T07:30:00.0000000-08:00
name: Harry
avatar: https://disqus.com/api/users/avatars/Harry.jpg
message: <p>MVC 5 changed the definition of the Attribute quite a bit.  This is what I put together to allow getting the fields from either the header or the original form field.  It ended up being a lot simpler than the original concept.</p><p>    [AttributeUsage(AttributeTargets.Method | AttributeTargets.Class,<br>        AllowMultiple = false, Inherited = true)]<br>    public class ValidateJsonAntiForgeryTokenAttribute :<br>        FilterAttribute, IAuthorizationFilter<br>    {<br>        public void OnAuthorization(AuthorizationContext filterContext)<br>        {<br>            if (filterContext == null)<br>            {<br>                throw new ArgumentNullException("filterContext");<br>            }</p><p>            var formValue = filterContext.RequestContext.HttpContext.Request.Form["__RequestVerificationToken"];<br>            var headerValue = filterContext.RequestContext.HttpContext.Request.Headers["__RequestVerificationToken"];<br>            string cookieValue = null;<br>            var cookieInstance = filterContext.RequestContext.HttpContext.Request.Cookies["__RequestVerificationToken"];<br>            if (cookieInstance != null)<br>            {<br>                cookieValue = cookieInstance.Value;<br>            }</p><p>            if (formValue == null)<br>            {<br>                formValue = headerValue;<br>            }</p><p>            AntiForgery.Validate(cookieValue, formValue);<br>        }<br>    }</p>
