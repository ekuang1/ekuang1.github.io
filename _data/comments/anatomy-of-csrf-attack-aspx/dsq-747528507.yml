id: dsq-747528507
date: 2009-04-02T00:52:04.0000000-07:00
name: Travis Illig
avatar: https://disqus.com/api/users/avatars/tillig.jpg
message: "<p>The \"POST-only\" protection makes a big assumption that rarely gets mentioned (or, at least, emphasized): <strong>it assumes the user is navigating the web with a trusted browser</strong>.<br>If the user is not using a secure browser, the anti-forgery token does no good. An insecure browser will allow a cross-domain GET (to retrieve the form) and will allow the results of the cross-domain GET to be inspected. The attacker's client-side script, then, would:<br>1) Do a GET to retrieve the form.<br>2) Do some string parsing to find the anti-forgery token.<br>3) Craft a valid POST request and include the anti-forgery token.<br>That would yield success even with the token in place.<br>Granted, most modern browsers are properly patched up and won't let you do that, but is everyone using the latest and greatest? Isn't there a push to rid the world of IE6 right now?<br>Would it surprise you to know I've seen browser reports including people coming in with the Compuserve browser and Netscape 6.x still?<br>You can see how the cross-domain GET-then-POST works by adding a \"good\" site and your test \"bad\" site both to Internet Explorer's \"Trusted Sites\" list - if they're both in that list, you can do a cross-domain GET and inspect the results. (No, users shouldn't be adding malicious sites to their trusted sites list, but can you guarantee they didn't? Plus, how many times have you been navigating in Windows Server 2003's locked-down browsing mode and just added the damn site to the list because you just needed to get something done?)<br>Anyway, the POST-only anti-forgery token solution is a great 80% solution, it just makes a big assumption that it may not be safe for your application to make.<br><a href=\"http://en.wikipedia.org/wiki/CSRF\" rel=\"nofollow noopener\" title=\"http://en.wikipedia.org/wiki/CSRF\">Wikipedia has a good CSRF article</a> talking about different prevention techniques.</p>"
